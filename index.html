<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video ke Suara Efek Jadul</title>
<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.0/dist/ffmpeg.min.js"></script>
<style>
  body { font-family: Arial; text-align: center; padding: 20px; background: #f0f0f0; }
  video { width: 80%; margin: 10px 0; }
  select, button { padding: 10px; margin: 5px; font-size: 16px; }
</style>
</head>
<body>

<h1>Konversi Video dengan Efek Suara Jadul</h1>
<input type="file" id="videoInput" accept="video/*"><br>
<select id="preset">
  <option value="nokia">HP Nokia</option>
  <option value="proklamasi">Telepon Jadul Smooth</option>
  <option value="rusak">Telepon Rusak / Glitch</option>
</select><br>
<button id="processBtn" disabled>Proses & Download</button>
<p id="status"></p>
<video id="preview" controls></video>

<script>
const { createFFmpeg, fetchFile } = FFmpeg;
const ffmpeg = createFFmpeg({ log: true });
const videoInput = document.getElementById("videoInput");
const preview = document.getElementById("preview");
const processBtn = document.getElementById("processBtn");
const status = document.getElementById("status");

let videoFile;

videoInput.addEventListener("change", (e) => {
  videoFile = e.target.files[0];
  preview.src = URL.createObjectURL(videoFile);
  processBtn.disabled = false;
});

processBtn.addEventListener("click", async () => {
  if (!videoFile) return;
  status.innerText = "‚è≥ Sedang memuat ffmpeg...";
  if (!ffmpeg.isLoaded()) await ffmpeg.load();

  ffmpeg.FS("writeFile", "input.mp4", await fetchFile(videoFile));

  const preset = document.getElementById("preset").value;
  let filter = "";

  if (preset === "nokia") {
    // Suara narrowband seperti HP Nokia jadul
    filter = "aresample=8000,asetrate=8000";
  } else if (preset === "proklamasi") {
    // Telepon jadul 90-an smooth
    filter = "aecho=0.8:0.9:1000:0.3,highpass=f=300,lowpass=f=3000";
  } else if (preset === "rusak") {
    // Telepon rusak / glitch
    filter = "aresample=6000,asetrate=6000,acrusher=1:1:64:0:log,anoisesrc=d=10:a=0.1";
  }

  status.innerText = "üéõÔ∏è Sedang memproses video...";
  await ffmpeg.run(
    "-i", "input.mp4",
    "-af", filter,
    "output.mp4"
  );

  const data = ffmpeg.FS("readFile", "output.mp4");
  const url = URL.createObjectURL(new Blob([data.buffer], { type: "video/mp4" }));

  const a = document.createElement("a");
  a.href = url;
  a.download = "hasil_konversi.mp4";
  a.click();

  status.innerText = "‚úÖ Selesai! File sudah di-download.";
});
</script>

</body>
</html>
